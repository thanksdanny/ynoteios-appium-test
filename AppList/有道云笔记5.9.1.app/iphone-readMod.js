/* reader Copyright (c) 网易有道 */
!function(a){"use strict";if(!a.define){var b,c={},d=null,e=function(a){return"[object Function]"===Object.prototype.toString.call(a)},f=function(a){var b=c[a];if(!b)throw new Error("Module "+a+" is not defined.");return b.inited===!1&&g(a),b.ret},g=function(a){var b,d={},g=c[a],h=g.factory;e(h)?(b=h.apply(void 0,[f,d,void 0]),g.ret=void 0===b?d:b):g.ret=h,g.inited=!0},h=a.document.getElementsByTagName("script"),i=h.length;for(b=0;i>b&&!d;b++)d=h[b].getAttribute("data-main");if(!d)throw new Error("No data-main attribute in script tag.");a.define=function(a,b,f){if(c[a])throw new Error("Module "+a+" has been defined already.");e(b)&&(f=b),c[a]={factory:f,inited:!1},a===d&&g(a)}}}(window),define("android/reader/event/check",function(a){var b=a("common/lib/zepto");return{isInnerImg:function(a){if(!a)return!1;var c=a.src+" ",d="note.youdao.com",e=".corp.youdao.com";return b(a).is("img")&&(c.indexOf(d)>-1||c.indexOf(e)>-1||0===c.indexOf("file:///"))},isAttachArea:function(a){if(!a)return!1;var c,d=b(a),e=".att_container";return d.is(e)?a:(c=d.parents(e),c&&c.length?c.get(0):!1)},isLink:function(a){if(!a)return!1;var c,d,e=this;return e.isImgLink(a)?!1:(c=b(a),d=c.is("a")?a:c.parents("a").get(0),d&&d.href?d.href:!1)},isImgLink:function(a){var c,d,e=this;return e.isInnerImg(a)?(c=b(a),d=c.parents("a").get(0),d?{img:a,link:d}:!1):!1},isTodoArea:function(a){if(a&&3===a.nodeType&&(a=a.parentNode),!a||!a.webkitMatchesSelector)return!1;var c=b(a).parents(".ynote-todo-item").get(0),d=".ynote-todo-checkbox";return c?{isOnCheck:!(!b(a).is(d)&&!b(a).parents(d).length),itemContainer:c}:!1}}}),define("android/reader/event/clickHandler",function(a){var b=a("common/lib/zepto"),c=a("android/reader/event/check"),d=a("common/dom/dataset"),e=a("common/console");return function(a,f){var g,h,i,j,k,l=a.target;if(l)return g=b(l),h=c.isImgLink(l),h&&h.link.href?(i=d.get(h.img,"id"),void(i&&(a.preventDefault(),f.asyncOpenImageLink({linkHref:h.link.href,imgId:i})))):(h=c.isLink(l))?(a.preventDefault(),void f.asyncOpenLink(h)):(h=c.isInnerImg(l),h&&(i=d.get(l,"id"))?void f.asyncOpenImage(i):(h=c.isAttachArea(l),h&&(e.log(h.outerHTML),i=d.get(h,"id"))?(h=b(h),h.is(".att_done")||h.is(".att_loading")||h.addClass("att_loading"),void f.asyncOpenAttachment(i)):(h=c.isTodoArea(l),h&&h.itemContainer&&(i=d.get(h.itemContainer,"id"))?void(h.isOnCheck?(j=".ynote-todo-checkbox img",j=b(h.itemContainer).find(j).get(0),k=-1===j.src.indexOf("uncheck"),j.src="../"+(k?"un":"")+"check_mark.png",k?b(h.itemContainer).removeClass("ynote-todo-checked"):b(h.itemContainer).addClass("ynote-todo-checked"),f.asyncRequestSetTodoInfo({todoId:i,checked:!k})):f.asyncRequestEditTodo(i)):void f.asyncSingleTouch())))}}),define("common/bom/userAgent",function(){var a=window.navigator.userAgent,b={CHROME:/Chrome/.test(a),IPHONE:/iPhone/.test(a)||/iPod/.test(a),IPAD:/iPad/.test(a),IOS_4:/ OS 4/.test(a),IOS_5:/ OS 5/.test(a),IOS_6:/ OS 6/.test(a),RETINA:window.devicePixelRatio>=2,IPHONE5:!1,ANDROID:/Android/i.test(a)};return b.IPHONE5=b.IPHONE&&568===window.screen.height,b}),define("common/console",function(){for(var a,b=this,c=b.DEBUG||null!=b.logLevel,d=b.console,e={},f=function(){},g="log warn error time timeEnd profile profileEnd".split(" "),h=g.length;--h>=0;)a=g[h],c&&d[a]?e[a]=d[a].bind(d):e[a]=f;return e.DEBUG=c,e}),define("common/dom/createDom",function(){return function(a){var b,c,d;if(a=a||document,a.implementation&&a.implementation.createHTMLDocument)return b=a.implementation.createHTMLDocument("title"),b.body.innerHTML="",{doc:b,root:b.body};if(d=a.defaultView||window,d.DOMParser){c=new d.DOMParser;try{b=c.parseFromString("","text/html")}catch(e){}if(b)return b.body.innerHTML="",{doc:b,root:b.body}}return{doc:a,root:a.createElement("div")}}}),define("common/dom/dataset",function(){var a=function(a){return"data-"+a.replace(/[A-Z]/g,function(a){return("-"+a).toLowerCase()})};return{get:function(b,c){return c?b.dataset?b.dataset[c]:b.getAttribute(a(c)):void 0},set:function(b,c,d){c&&(d=String(d),b.dataset?b.dataset[c]=d:b.setAttribute(a(c),d))},remove:function(b,c){c&&(b.dataset?delete b.dataset[c]:b.removeAttribute(a(c)))}}}),define("common/dom/fixMinHeight",function(a){var b=a("common/lib/zepto"),c=2;return function(a){a=a||0;var d=b(window).height();d=d+c-a+"px",b(".reader",document.body).css({"min-height":d})}}),define("common/dom/outerHeight",function(a){var b=a("common/lib/zepto");return function(a){var c=b(a),d=["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"],e=0;return b.each(d,function(a,b){e+=parseInt(c.css(b),10)||0}),c.height()+e}}),define("common/dom/parseHTML",function(){var a=function(a,b){var c,d,e;if(b.implementation&&b.implementation.createHTMLDocument)return c=b.implementation.createHTMLDocument("title"),c.body.innerHTML=a,c;if(e=b.defaultView||window,e.DOMParser){d=new e.DOMParser;try{c=d.parseFromString("","text/html")}catch(f){}if(c)return c.body.innerHTML=a,c}};return function(b,c,d){if(b){c=c||document;var e,f,g,h,i=a(b,c);if(i){if(d!==!1)return i.body;for(g=i.body.childNodes,e=g.length,h=[],f=0;e>f;f++)h.push(g[f]);return h}}}}),define("common/dom/setTimeout",function(a){var b=a("common/bom/userAgent");return b.ANDROID?function(a){a()}:window.setTimeout}),define("common/lib/underscore",function(){var a=window._;return a?a:(window.console.log("error no underscore.js"),a)}),define("common/lib/zepto",function(){var a=window.Zepto;if(a||window.console&&window.console.log("error no Zepto.js"),!window.DEBUG)try{delete window.Zepto}catch(b){window.Zepto=null}return a}),define("common/math/base64",function(){return{encode:function(a){return window.btoa(window.unescape(encodeURIComponent(a)))},decode:function(a){return decodeURIComponent(window.escape(window.atob(a)))}}}),define("common/num/padZeros",function(){return function(a,b){a=String(a);var c=a.length,d=[];return b>c&&(d.length=b-c+1,a=d.join("0")+a),a}}),define("common/str/truncate",function(){return function(a,b,c,d){if(c=c||"...",d=d===!0,!a||!b)return a;var e,f,g,h,i,j,k=a.length;if(d){for(i=0,h=c.length,f=0;h>f;f++)i+=c.charCodeAt(f)<256?.5:1;if(i>b)return a;for(e=0,f=0;k>f;f++)e+=a.charCodeAt(f)<256?.5:1;if(b>=e)return a;for(b-=i,g=0,j=[],f=0;k>f&&b>g;f++)g+=a.charCodeAt(f)<256?.5:1,j.push(a.charAt(f));return j.join("")+c}return h=c.length,h>b||b>=k?a:(a=a.substr(0,b-h),a+c)}}),define("common/str/unescapeHtml",function(){return function(a){if(!a)return a;var b,c='<input temp="'+a+'" />',d=document.createElement("div");return d.innerHTML=c,b=d.querySelector("input"),b?b.getAttribute("temp"):a}}),define("common/ui/template",function(a){var b=a("common/lib/underscore"),c=a("common/console"),d={};return function(a){if(!d[a]){var e=document.getElementById(a+"Template");if(!e)return void c.error("<template> no template: "+a);e=e.innerHTML,d[a]=b.template(e)}return d[a]}}),define("reader/attachment/calculateSize",function(){return function(a){var b=0;return a=a||0,b=1024>a?a+"B":a>=1024&&1048576>a?(a/1024).toFixed(2)+"KB":(a/1048576).toFixed(2)+"MB"}}),define("reader/attachment/getIcon",function(a){var b=a("common/lib/underscore");return function(a){a=(a||"").toLowerCase();var c,d,e=/\.([a-z\d]+)$/.exec(a),f=".png",g="other_type",h={txt:["txt"],word:["doc","docx"],powerpoint:["ppt","pptx"],excel:["xls","xlsx"],pdf64:["pdf"],audio:["mp3","aac","ogg","wav","flac","m4a","ape","amr"],video:["rm","rmvb","avi","mkv","mpg","mpeg","wmv","ts","m4v","mp4","wma","mov"],picture:["jpg","jpeg","gif","png","bmp","psd","ia"],rar:["zip","rar","7zp"],html:["html","htm","mht"],swf:["swf","flv"]};return e&&e[1]?(c=e[1],b.any(h,function(a,e){return b.indexOf(a,c)>-1?(d=e,!0):void 0})):d=g,d=d||g,d+=f}}),define("reader/event/check",function(a){var b=a("common/lib/zepto");return{isInnerImg:function(a){if(!a)return!1;var c=a.src+" ",d="note.youdao.com",e=".corp.youdao.com";return b(a).is("img")&&(c.indexOf(d)>-1||c.indexOf(e)>-1||0===c.indexOf("file:///"))},isAttachArea:function(a){if(!a)return!1;var c,d=b(a),e=".att_container";return d.is(e)?a:(c=d.parents(e),c&&c.length?c.get(0):!1)},isLink:function(a){if(!a)return!1;var c,d,e=this;return e.isImgLink(a)?!1:(c=b(a),d=c.is("a")?a:c.parents("a").get(0),d&&d.href?d.href:!1)},isImgLink:function(a){var c,d,e=this;return e.isInnerImg(a)?(c=b(a),d=c.parents("a").get(0),d?{img:a,link:d}:!1):!1}}}),define("reader/event/clickHandler",function(a){var b=a("common/lib/zepto"),c=a("reader/event/check"),d=a("common/dom/dataset");return function(a,e){var f,g,h,i=a.target;if(i){if(f=b(i),g=c.isImgLink(i),g&&g.link.href&&(h=d.get(g.img,"origSrc")))return a.preventDefault(),void e.asyncOpenImageLink({linkHref:g.link.href,imgSrc:h});if(g=c.isLink(i)){if(!/^http/i.test(g))return;return a.preventDefault(),void e.asyncOpenLink(g)}return c.isInnerImg(i)&&(h=d.get(i,"origSrc"))?void e.asyncOpenImage(h):(g=c.isAttachArea(i))?(g=b(g),void e.asyncOpenAttachment({path:g.attr("path"),fileName:g.attr("filename"),fileLength:g.attr("filelength")})):void e.asyncSingleTouch()}}}),define("reader/filter/buildAttachment",function(a){var b=a("common/lib/zepto"),c=a("common/lib/underscore"),d=a("common/ui/template"),e=a("reader/attachment/getIcon"),f=a("reader/attachment/calculateSize"),g=a("common/console"),h=d("attachment");return{name:"buildAttachment",action:function(a){var d="img[path], img[data-media-type=attachment]";b(a.el).find(d).each(function(){g.log("3333");var a,d=b(this),i=this.parentNode,j=d.attr("filename")||d.attr("title")||d.attr("alt"),k=d.attr("filelength"),l=d.attr("path"),m=e(j),n=d.attr("src"),o=f(k);a=h({att_index:c.uniqueId("att_id_"),icon_src:m,file_length:k,file_name:j,path:l,origSrc:n,file_size:o}),i&&"SPAN"===i.tagName&&1===i.children.length?i.outerHTML=a:this.outerHTML=a})}}}),define("reader/filter/buildTodo",function(a){var b=a("common/lib/zepto"),c=a("common/lib/underscore"),d=a("common/ui/template"),e=a("common/dom/dataset"),f=a("common/console"),g="img[data-media-type=todo]",h=d("todoBone");return{name:"buildTodo",action:function(a){var d,i,j,k,l,m,n,o=a.share,p=[],q=[];for(d=a.el.querySelectorAll(g),i=d.length,j=0;i>j;j++){for(k=d[j],l=[],n=d[j+1];k;)l.push(k),m=k.nextSibling,m&&n&&(m===n||m.nextSibling===n&&(1!==m.nodeType&&!b.trim(m.nodeValue)||"BR"===m.tagName))?(k=n,j+=1,n=d[j+1]):k=null;p.push(l)}c.each(p,function(a){var b,d,g,i,j=[],k=a.length;if(c.each(a,function(a){j.push(e.get(a,"resTodo"))}),b=h({todoIDs:j}),q=q.concat(j),g=c.first(a),f.log("====>>"),k>1){for(d=c.last(a),i=g.parentNode;g.nextSibling!==d;)i.removeChild(g.nextSibling);i.removeChild(d)}g.outerHTML=b}),q.length&&o.requests.push({apiName:"asyncRequestGetTodoInfo",params:[q]})}}}),define("reader/filter/clearCSS",function(a){var b=a("common/lib/zepto"),c=a("common/lib/underscore"),d=a("common/bom/userAgent");return{name:"clearCSS",action:function(a){var e=["style","id","class","height","width","size","color","bgcolor","background"],f=function(a){if(!d.ANDROID)return!1;var c=b(a);return c.is("table.rborder")||c.is("table.rborder *")?!0:c.is("div.ynote_todo_group")||c.is("div.ynote_todo_group *")?!0:c.is("img.android-resource-handwrite")||c.is("img.android-resource-img")?!0:void 0};b(a.el).find("*").each(function(){var a=this;f(a)||c.each(e,function(b){a.removeAttribute(b)})})}}}),define("reader/filter/clearElement",function(a){var b=a("common/lib/zepto");return{name:"clearElement",action:function(a){b(a.el).find("iframe").remove()}}}),define("reader/filter/filterM",function(a){var b=a("common/lib/underscore"),c=function(a,c){var d,e;a&&a.name&&a.action&&(e=a.name,d=b.any(c,function(a){return a.name===e}),d!==!0&&c.push(a))};return function(){var a=[];return{add:function(d){b.isArray(d)?b.each(d,function(b){c(b,a)}):c(d,a)},remove:function(c){var d;c||(d=b.find(a,function(a){return a.name===c}),-1!==d&&(a=a.slice(d,1)))},removeAll:function(){a=[]},runFilters:function(c,d){d&&(d=b.isArray(d)?d:[d]),b.each(a,function(a){(!d||d&&-1===b.indexOf(d,a.name))&&a.action.call(null,c)})}}}}),define("reader/filter/image",function(a){var b=a("common/lib/zepto"),c=a("common/dom/dataset"),d=a("reader/event/check"),e=a("reader/util/consts"),f=["image","handwrite","attachment","todo"],g='<div class="ukn_container"><div></div><p>该内容无法显示，您的客户端尚未支持此功能或非最新版本</p></div>';return{name:"image",action:function(a){var h=a.share,i=[];b(a.el).find("img").each(function(){var a,j,k,l=this,m=c.get(l,"mediaType");return m&&-1===f.indexOf(m)?void(l.outerHTML=g):(j=b(l).attr("path"),void(m&&"attachment"===m||!m&&j||m&&"todo"===m||(m||c.set(l,"mediaType","image"),m&&"handwrite"===m&&(a=c.get(l,"resHandwrite"),a&&(i.push({pkg:a,src:l.getAttribute("src")}),l.parentNode&&(k=document.createElement("div"),k.innerHTML='<span class="ynote-handwrite-bg"></span>',l.parentNode.insertBefore(k,l),k.children[0].appendChild(l)))),d.isInnerImg(l)&&(j=l.src,c.set(l,"origSrc",j),e&&e.BLANK_IMG_PATH&&(l.src=e.BLANK_IMG_PATH),h.requests.push({apiName:"asyncRequestReplaceImage",params:[j]})))))}),i.length&&h.requests.push({apiName:"asyncRequestLoadHandwritePackages",params:[i]})}}}),define("reader/filter/updateAttachmentState",function(a){var b=a("common/lib/zepto");return{name:"updateAttachmentState",action:function(a){var c=a.share;b(a.el).find(".att_container").each(function(){var a=b(this);c.requests.push({apiName:"asyncCheckAttachmentState",params:[{id:a.attr("id"),path:a.attr("path"),fileName:a.attr("filename"),fileLength:a.attr("filelength")}]})})}}}),define("reader/io/readerApi",function(a){var b=a("common/lib/underscore"),c=a("common/math/base64"),d=a("reader/io/readerApiInterface"),e=a("common/console"),f=function(a){var b=[];if(a)try{b=c.decode(a);try{b=JSON.parse(b)}catch(d){e.error("Illegal json args: "+b)}}catch(f){e.error("Illegal base64 args: "+a)}return b},g=function(){};return function(a){if(!a)return void e.error("<readerApi> param reader is not valid");if(!window.Reader){var h={};b.each(d,function(b,d){a[d]?h[d]=function(b){var g,h=f(b),i="exec reader api "+d;e.time(i),e.log("exec reader api: "+d,h);try{g=a[d].apply(a,h)}catch(j){e.error("[ReaderApi -> "+d+"]: "+j.toString()+j.stack.toString())}return void 0===g?void e.timeEnd(i):(g=c.encode(JSON.stringify({result:g})),e.log("return value",g),e.timeEnd(i),g)}:(e.error('<readerApi> reader has no api "'+d+'"'),h[d]=g)}),window.Reader=h}}}),define("reader/io/readerApiInterface",function(){return{setTitle:function(a){},setContent:function(a,b){},setFontSize:function(a){},setTheme:function(a){},replaceImage:function(a,b,c){},setAttachmentState:function(a,b){},setTodoInfo:function(a){},getCurrentPosition:function(){},setCurrentPosition:function(a){},setFontFamily:function(a){}}}),define("reader/io/webViewApi",function(a){var b=a("common/console"),c=a("common/lib/underscore"),d=a("common/math/base64"),e={Ready:function(){b.log("<webViewApi>Ready")},OpenImage:function(a){b.log("<webViewApi>OpenImage src: "+a)},OpenAttachment:function(a){b.log("<webViewApi>OpenAttachment info: "),b.log(a)},CheckAttachmentState:function(a){b.log("<webViewApi>CheckAttachmentState info: "),b.log(a)},OpenLink:function(a){b.log("<webViewApi>OpenLink href: "+a)},OpenImageLink:function(a){b.log("<webViewApi>OpenImageLink "),b.log("linkHref: "+a.linkHref),b.log("imgSrc: "+a.imgSrc)},RequestReplaceImage:function(a){b.log("<webViewApi>RequestReplaceImage : "+a)},SingleTouch:function(){b.log("<webViewApi>SingleTouch")},RequestGetTodoInfo:function(a){b.log("<webViewApi>RequestGetTodoInfo: "+a.join(","))},RequestLoadHandwritePackages:function(a){b.log("WebView.RequestLoadHandwritePackages: "+a.join(","))},Log:function(){},LOG_DEBUG:3,LOG_INFO:2,LOG_WARN:1,LOG_FATAL:0},f={};return Object.keys(e).forEach(function(a){return c.isFunction(e[a])?void(f["async"+a]=function(){var f,g,h=c.toArray(arguments);e[a].apply(null,h),f={argument:h},g=document.createElement("iframe"),g.style.display="none",g.src="async:"+a+":"+d.encode(JSON.stringify(f)),document.body.appendChild(g),document.body.removeChild(g),b.log("<webViewApi> async"+a+" end")}):void(f[a]=e[a])}),window.DEBUG&&/^http/i.test(window.location.href)&&c.each(e,function(a,b){c.isFunction(a)&&(f["async"+b]=a)}),f}),define("reader/reader",function(a){var b,c=a("common/lib/zepto"),d=a("common/lib/underscore"),e=a("reader/event/clickHandler"),f=a("android/reader/event/clickHandler"),g=a("common/str/truncate"),h=a("common/console"),i=a("common/bom/userAgent"),j=a("reader/todo/todoTimeFormate"),k=a("common/dom/dataset"),l=a("common/ui/template"),m=a("common/dom/fixMinHeight"),n=a("common/dom/setTimeout"),o=a("common/str/unescapeHtml"),p=a("common/dom/outerHeight"),q=a("common/dom/parseHTML"),r=a("common/dom/createDom"),s=l("todoItemInner"),t={},u=null,v="无标题笔记",w=1e8,x='<div class="locker_container"><div class="locker_img_wrap"><img class="locker_light" src="readModLockerLight@2x.png"/><img class="locker_dark" src="readModLockerDark@2x.png"/></div><p>当前笔记已设置阅读密码，</p><p>返回至查看界面输入密码查看内容</p></div>',y=function(a,b){return a=c.trim(a+"").replace(/^https:/,"http:"),b=c.trim(b+"").replace(/^https:/,"http:"),a===b};return function(a){a=c.extend({webViewApi:null,container:null,preFilterM:null,inFilterM:null,themes:[],defaultIndex:0},a);var l=a.container,z=a.webViewApi,A=a.themes[a.defaultIndex],B=i.ANDROID?f:e,C=!1,D={title:null,scrollY:null};return m(16),l.addEventListener("touchstart",function(a){var c=a.touches[0];c&&null!=c.clientX?(t.x=c.clientX,t.y=c.clientY):t={},b=a.touches,h.log("touch start....")},!1),l.addEventListener("touchmove",function(a){b=a.touches},!1),l.addEventListener("touchend",function(a){if(!b||!b[0])return t={},void(b=null);var c=b[0];h.log("touch.identifier: "+c.identifier),(i.ANDROID||c.identifier!==u)&&(u=c.identifier,null!=c.clientY&&null!=t.x&&Math.pow(t.x-c.clientX,2)+Math.pow(t.y-c.clientY,2)<100&&(h.log("run clickHandler"),B({target:c.target,preventDefault:function(){a.preventDefault()}},z)),t={},b=null)},!1),{container:l,setDeviceInfo:function(a){var b=this;b._deviceInfo=a},setTitleAndContent:function(a,b){h.log("set title and content .....");var c=this;D.title=null,C=!1,c.setContent(b),c.setTitle(a)},setTitle:function(a){var b,d,e,f;null!=a&&(C===!0?(D.title=null,a=String(a||""),a=c.trim(a)||v,a=a&&a!==v?g(a,18,"...",!0):v,b=c("h1.article_title",l),b&&b.length?b.text(a):c("<h1/>").addClass("article_title").text(a).prependTo(l),D.isEncrypted&&window.setTimeout(function(){b=c(".article_title",l),f=b.height(),e=c(l).height(),d=c(".locker_container",l),d.css("top",f+8+(e-f-8-d.height()-44)/2+"px")},50)):D.title=a)},setContent:function(b,e){h.log("setContent:"+b);var f,g,j=this,k=".att_container.att_init",m=3e3,o=[];return i.IOS_5&&c("a",l).unbind("click"),e===!0?(D.isEncrypted=!0,l.innerHTML=x,C=!0,void j.setTitle(D.title)):(l.style.visibility="hidden",f=q(b,document,!0),d.each(["preFilterM","inFilterM"],function(b){var c=a[b],d={webViewApi:z,requests:[]};c&&c.runFilters&&(h.log("run filterM: "+b),c.runFilters({el:f,share:d}),h.log("run filterM: "+b+" ... DONE"),d.requests&&d.requests.length&&(o=o.concat(d.requests)))}),g=f.innerHTML,h.log("filtered html: "+g),l.innerHTML=g,f=null,d.each(o,function(a){var b=a.apiName,c=a.params||[];b&&z[b]&&z[b].apply(z,c)}),i.IOS_5&&c("a",l).bind("click",function(a){a.preventDefault()}),C=!0,j._setHandwriteBg(l.className),j.setTitle(D.title),n(function(){l.style.visibility="visible",null!=D.scrollY&&j.setCurrentPosition(D.scrollY)},50),void n(function(){c(l).find(k).removeClass("att_init")},m))},setFontSize:function(a){D.isEncrypted!==!0&&a&&(l.style.fontSize=a+"px")},setTheme:function(b,c){var d=this,e=a.themes[b]||A,f=e.className;l.className="reader "+f,c===!0&&(document.documentElement.style.backgroundColor=e.bgColor),d._setHandwriteBg(f)},_setHandwriteBg:function(a){var b=a.indexOf("_3")>-1||a.indexOf("_4")>-1,d=".ynote-handwrite-bg";b?c(l).find(d).css("background-color","#A2A2A2"):c(l).find(d).css("background-color","")},getContentWidth:function(){return c(l).width()},setAttachmentState:function(a,b,d){h.log("id: "+a),h.log("percent: "+b);var e,f=100>b&&b>0?b+"%":"",g="att_loading",i="att_done",j="att_init",k=a&&1===a.nodeType?a:document.getElementById(a);k&&(f&&(f=(d===!0?"上传: ":"下载: ")+f),e=c(k),e.removeClass(j).find(".att_progress").text(f),b>=100?e.removeClass(g).addClass(i):100>b&&b>=0?e.removeClass(i).addClass(g):e.removeClass(i).removeClass(g))},replaceImage:function(a,b,d,e,f){var g,h,i=function(a,b,c){a.src=b,c===!0&&(null!=e?(a.style.height="auto",a.style.width=e/2+"px"):null!=f&&(a.style.width="auto",a.style.height=f/2+"px"))};return a&&a.tagName&&"img"===a.tagName.toLowerCase()?void i(a,b,d):(h=r(),g=h.doc.createElement("img"),g.src=a,a=g.src,g=null,h=null,void c(l).find("img").each(function(c,e){var f=e.dataset.origSrc||e.src;y(f,a)&&i(e,b,d)}))},setTodoInfo:function(a){var b=c(l),e=b.find(".ynote-todo-item");d.each(a,function(a){var b=a.todoId;e.each(function(e,f){var g,h,i,l,m=k.get(f,"todoId"),n="无内容提醒";m===b&&(i=c(f),l=d.extend({checked:!1,content:"",startTime:""},a),l.startTime&&(l.startTime=j(l.startTime)),l.checked?i.addClass("ynote-todo-done").removeClass("ynote-todo-showtime"):(i.removeClass("ynote-todo-done"),l.startTime?i.addClass("ynote-todo-showtime"):i.removeClass("ynote-todo-showtime")),g=l.content||"",g=o(g),l.content="",g?i.removeClass("ynote-todo-notitle"):(g=n,i.addClass("ynote-todo-notitle")),l.checked&&i.addClass("ynote-todo-done"),i.html(s(l)).find(".ynote-todo-title").text(g),h=i.height(),h=Math.floor((h-6)/2),i.find(".ynote-todo-check").css("top",h+"px"))})})},getCurrentPosition:function(){var a=c("h1.article_title",l),b=a&&a.length?p(a):0,d=p(l)-b,e=Math.round((window.scrollY-b)/d*w);return h.log("getCurrentPosition -> percent: "+e),e},setCurrentPosition:function(a){if(null!=a&&D.isEncrypted!==!0){var b,d,e,f;if(C===!0){if(D.scrollY=null,0>=a)return;if(b=c("h1.article_title",l),d=b&&b.length?p(b):0,e=p(l)-d,f=(e-d)*a/w+d,0>=f)return;window.scrollTo(0,f)}else D.scrollY=a}},setFontFamily:function(a){a&&(l.style.fontFamily=String(a))}}}}),define("reader/todo/todoTimeFormate",function(a){var b=a("common/lib/underscore"),c=a("common/num/padZeros"),d="<%=fullYear%>.<%=fullMonth%>.<%=fullDate%> 周<%=weekDay%> <%=fullHours%>:<%=fullMinutes%>",e=["日","一","二","三","四","五","六"],f=function(a){return c(a,2)};return d=b.template(d),function(a){if(!b.isDate(a)){try{a=new Date(a)}catch(c){}if(!b.isDate(a))return}var g={fullYear:a.getFullYear(),fullMonth:f(a.getMonth()+1),fullDate:f(a.getDate()),weekDay:e[a.getDay()],fullHours:f(a.getHours()),fullMinutes:f(a.getMinutes())};return d(g)}}),define("reader/util/consts",function(a){var b=a("common/bom/userAgent"),c={};return(b.IPHONE||b.IPAD)&&(c.BLANK_IMG_PATH="./blank.png"),c}),define("init/iphone",function(a){var b,c,d,e=a("reader/reader"),f=a("reader/io/readerApi"),g=a("reader/io/webViewApi"),h=a("reader/filter/filterM"),i=a("reader/filter/clearCSS"),j=a("reader/filter/clearElement"),k=a("reader/filter/buildAttachment"),l=a("reader/filter/updateAttachmentState"),m=a("reader/filter/buildTodo"),n=a("reader/filter/image"),o=a("common/console"),p=document.querySelector("#reader"),q=0;return p?(c=new h,c.add([j,i]),d=new h,d.add([n,k,l,m]),b=e({webViewApi:g,container:p,preFilterM:c,inFilterM:d,themes:[{className:"theme_1",bgColor:"#F7F7F7"},{className:"theme_2",bgColor:"#e2dbcb"},{className:"theme_3",bgColor:"#261607"},{className:"theme_4",bgColor:"#313131"}]}),f(b),window.DEBUG&&!/^http/i.test(window.location.href)&&(q=1e4),window.setTimeout(function(){g.asyncReady()},q),void(window.DEBUG&&(window.noteReader=b))):void o.error("<iphone.js> no container")});