this.JST=this.JST||{},this.JST["mobile/ynote_table_viewer"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<div class="table-wrapper"><div id="tabContainer" class="tab-container"><ul class="tab">';for(sheet in tableData)__p+='<li><p class="tablinks" data-value="'+(null==(__t=tableData[sheet].sheetId)?"":__t)+'">'+(null==(__t=tableData[sheet].sheetName)?"":__t)+"</p></li>";__p+='</ul></div><div class="sheet-container">';for(sheet in tableData)__p+="<div id="+(null==(__t=tableData[sheet].sheetId)?"":__t)+' class="sheet"><table><colgroup></colgroup><tbody></tbody></table></div>';__p+="</div></div>"}return __p};var ytb_jtk_core_console,ytb_jtk_jq_jquery,ytb_jtk_core_underscore,ytb_jtk_core_Class,ytb_src_mobile_core_YNoteBulbBridge,ytb_jtk_mvc_Backbone,ytb_jtk_web_console,ytb_src_templates_jst,ytb_jtk_core_Events,ytb_jtk_core_EventClass,ytb_src_client_shared_const,ytb_src_client_editor_TableConvertor,ytb_src_editor_config_defaults,ytb_src_editor_core_Table,ytb_jtk_web_dom_isTag,ytb_jtk_core_str_trim,ytb_jtk_core_reg_encode,ytb_jtk_web_dom_className,ytb_jtk_web_bom_userAgent,ytb_jtk_web_dom_attr,ytb_jtk_web_dom_Selector,ytb_jtk_web_dom_nodeType,ytb_jtk_web_dom_findParent,ytb_jtk_web_dom_insert,ytb_jtk_web_dom_remove,ytb_src_editor_utils_TableUtils,ytb_src_mobile_views_YNoteTableView,ytb_ynoteIndexjs;ytb_jtk_core_console=function(){var a,b=this,c=function(){},d={DEBUG:!1,EXPORTS:b.JTK_EXPORTS||{},log:c,warn:c,error:c};return b.DEBUG!==!0?d:b.console&&b.console.log?(a=b.console,d.DEBUG=!0,d.log=function(){var b,c=[],d=arguments.length;for(b=0;b<d;b++)c.push(String(arguments[b]));a.log(c.join(";"))},d.warn=function(a,b){var c=this;if(b=b?"["+b+"]":"",c.log(b+"WARN: "+a+"."),"object"==typeof a)throw a},d.error=function(a,b){var c=this;if(b=b?"["+b+"]":"",c.log(b+"ERROR: "+a+"!"),"object"==typeof a)throw a},d):d}(),ytb_jtk_jq_jquery=function(a){var b=ytb_jtk_core_console,c=window.jQuery||window.$;return c?(b.EXPORTS.jquery===!1&&c.noConflict&&(c=c.noConflict(!0)),c):void b.error("no jQuery library","jq/jquery.js")}({}),ytb_jtk_core_underscore=function(a){var b=ytb_jtk_core_console,c=this._||this.underscore;return c?(b.EXPORTS.underscore===!1&&c.noConflict&&(c=c.noConflict()),c):void b.error("no underscore library","core/underscore.js")}({}),ytb_jtk_core_Class=function(a){function b(a){var b=this;b.options=c.extend({},a),b.initialize.apply(b,arguments)}var c=ytb_jtk_core_underscore,d=function(a,b){var d,e,f=this;return d=a&&c.has(a,"constructor")?a.constructor:function(){return f.apply(this,arguments)},c.extend(d,f,b),e=function(){this.constructor=d},e.prototype=f.prototype,d.prototype=new e,a&&c.extend(d.prototype,a),d.__super__=f.prototype,d};return b.prototype.initialize=function(){},b.extend=d,b}({}),ytb_src_mobile_core_YNoteBulbBridge=function(a){var b,c;return b=a.extend({BridgeAPI:{getContent:function(){return window.btoa(window.unescape(encodeURIComponent(JSON.stringify(c.getContent()))))},getActiveSheetId:function(){return window.btoa(window.unescape(encodeURIComponent(c.getActiveSheetId())))},setContent:function(a,b){if(a)try{a=decodeURIComponent(window.escape(window.atob(a))),b&&(b=decodeURIComponent(window.escape(window.atob(b)))),c.setContent(JSON.parse(a),b)}catch(d){c.showError("无效的数据内容！"+d.message)}else c.showError("无效的数据内容！")}},initialize:function(a){if(!a||!a.tableView)throw"options.tableView cannot be null";c=a.tableView}})}(ytb_jtk_core_Class),ytb_jtk_mvc_Backbone=function(a){var b=ytb_jtk_core_console,c=ytb_jtk_jq_jquery,d=window.Backbone;return d?(b.EXPORTS.backbone===!1&&d.noConflict&&(d=d.noConflict(),d.$=c),d):void b.error("no Backbone library","mvc/backbone.js")}({}),ytb_jtk_web_console=function(a){var b,c=ytb_jtk_core_console,d=/msie/i.test(window.navigator.userAgent);return c.DEBUG&&window.console&&window.console.log&&(b=window.console,!d&&b.log.apply?c.log=function(){b.log.apply(b,arguments)}:c.log=function(){var a,c,d=arguments.length,e=[],f=window.JSON;for(a=0;a<d;a++){if(c=arguments[a],f)try{c=f.stringify(c)}catch(g){}e.push(String(c))}b.log(e.join(";"))}),c}({}),ytb_src_templates_jst=function(a){var b=ytb_jtk_web_console,c=this;return{getTemplate:function(a,b){var d=a+"/"+b;return c.JST[d]},render:function(a,c,d){var e=this.getTemplate(a,c);return e?e(d):void b.error("no tempalte: templates"+a+"/"+c+".jst","template/jst.js")}}}({}),ytb_jtk_core_Events=function(a){var b,c=ytb_jtk_core_underscore,d=Array.prototype.slice,e=/\s+/,f=function(a,b,c,d){var f,g,h;if(!c)return!0;if(e.test(c)){for(f=c.split(e),h=f.length,g=0;g<h;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},g=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},h={listenTo:"on",listenToOnce:"once"};return b={on:function(a,b,c){var d=this;return f(d,"on",a,[b,c])&&b?(d.__events||(d.__events={}),d.__events[a]||(d.__events[a]=[]),d.__events[a].push({callback:b,context:c,ctx:c||d}),d):d},once:function(a,b,d){var e,g=this;return f(g,"once",a,[b,d])&&b?(e=c.once(function(){g.off(a,e),b.apply(g,arguments)}),e._callback=b,g.on(a,e,d)):g},off:function(a,b,d){var e,g,h,i,j,k,l,m,n=this;if(!n.__events||!f(n,"off",a,[b,d]))return n;if(!a&&!b&&!d)return n.__events={},n;for(i=a?[a]:c.keys(n.__events),j=0,k=i.length;j<k;j++)if(a=i[j],h=n.__events[a]){if(n.__events[a]=e=[],b||d)for(l=0,m=h.length;l<m;l++)g=h[l],(b&&b!==g.callback&&b!==g.callback._callback||d&&d!==g.context)&&e.push(g);e.length||delete n.__events[a]}return n},trigger:function(a){var b,c,e,h=this;return h.__events?(b=d.call(arguments,1),f(h,"trigger",a,b)?(c=h.__events[a],e=h.__events.all,c&&g(c,b),e&&g(e,arguments),h):h):h},stopListening:function(a,b,c){var d,e,f=this,g=f.__listeners;if(!g)return f;d=!b&&!c,"object"==typeof b&&(c=f),a&&((g={})[a.__listenerId]=a);for(e in g)g[e].off(b,c,f),d&&delete f.__listeners[e];return f}},c.each(h,function(a,d){b[d]=function(b,d,e){var f,g,h=this;return f=h.__listeners||(h.__listeners={}),g=b.__listenerId||(b.__listenerId=c.uniqueId("l")),f[g]=b,"object"==typeof d&&(e=h),b[a](d,e,h),h}}),b.bind=b.on,b.unbind=b.off,b}({}),ytb_jtk_core_EventClass=function(a){var b=ytb_jtk_core_Class,c=ytb_jtk_core_Events;return b.extend(c)}({}),ytb_src_client_shared_const={OP:{CODE:"code",CLIENT_ID:"clientId",CLIENT_VERSION:"clientVersion",OTHER_VERSION:"otherVersion",SERVER_VERSION:"serverVersion",SHEET_ID:"sheetId"},SINGLE_CELL:{X:"x",Y:"y"},MULTIPLE_CELLS:{X1:"x1",Y1:"y1",X2:"x2",Y2:"y2"},CELL_OP:{PROP_KEY:"key",PROP_VALUE:"value",SHEET_ID:"sheetId"},LINE_OP:{INDEX:"index",COUNT:"count"},SET_ROWS_HEIGHT_OP:{HEIGHT:"height"},SET_COLUMNS_WIDTH_OP:{WIDTH:"width"},COMPOSITE_OP:{OPLIST:"opList"},FORMULA_OP:{X:"x",Y:"y"},OPS:{REQID:"reqId",CLIENT_ID:"clientId",CLIENT_VERSION:"clientVersion",OTHER_VERSION:"otherVersion",SERVER_VERSION:"serverVersion",OP_LIST:"opList"},SHEET_CHANGE_OP:{NAME:"name",INDEX:"index"},SHEET_DELETE_OP:{SHEET_ID:"sheetId"},SHEET_NEW_OP:{SHEET:"sheet"},REQUEST:{ID:"id",TYPE:"type"},COLLABORATE_REQUEST:{OPS:"ops"},SAVE_REQUEST:{FILEID:"saveId"},CLIENT_ID_TO_USER_REQUEST:{CLIENT_ID:"clientId"},FOCUS_CELL_REQUEST:{X:"x",Y:"y",SHEET_ID:"sheetId"},RESPONSE:{ID:"id",TYPE:"type",CLIENT_VERSION:"clientVersion",OTHER_VERSION:"otherVersion",SERVER_VERSION:"serverVersion"},GET_ID_RESPONSE:{CLIENT_ID:"clientId"},SYNC_RESPONSE:{CLIENT_ID:"clientId",FILE_ID:"fileId",SHEETS:"sheets",LOCATIONS:"locations",CONNECTED_CLIENTS:"clients"},COLLABORATE_RESPONSE:{OP_LIST:"opList"},CLIENT_ID_TO_USER_RESPONSE:{CLIENT_ID:"clientId",USER_ID:"userId",NAME:"name",PHOTO:"photo",DESCRIPTION:"description",LOCATION:"location",PHONE:"phone",EMAIL:"email",SEX:"sex"},NEW_TABLE_RESPONSE:{FILE_ID:"fileId"},SAVE_RESPONSE:{RESULT:"result",USER_ID:"saveUserId",CLIENT_ID:"saveClientId",FILE_ID:"saveId"},SAVE_RESPONSE_SUCCESS:0,SAVE_RESPONSE_FAILED:1,TABLE:{SHEETS:"sheets",LOCATION:"locations",SHEET_NAME:"sheetName",SHEET_ID:"sheetId",SHEET_CONTENT:"content",ROW_HEIGHTS:"heights",COLUMN_WIDTHS:"widths",CELLS:"cells",CLIENT_VERSION_MAP:"clientVersionMap",OTHER_VERSION_MAP:"otherVersionMap",SERVER_VERSION_MAP:"serverVersionMap",LAST_REQ_ID_MAP:"lastReqIdMap",CLIENT_INFO_MAP:"clientInfoMap",CURRENT_VERSION:"currentVersion",LAST_MODIFIED_USER_ID:"lastModifiedUserId",LAST_MODIFIED_TIME:"lastModifiedTime",NEXT_CLIENT_ID:"nextClientId"},TABLE_CELL:{VALUE:"value",FORMULAVALUE:"formulaValue",MERGE_WIDTH:"mergeWidth",MERGE_HEIGHT:"mergeHeight",MERGE_POINT_DIST_X:"mergePointDX",MERGE_POINT_DIST_Y:"mergePointDY"},CLIENT_INFO:{CLIENT_ID:"clientId",USER_ID:"userId",LAST_UPDATE_TIME:"lastUpdate"},CLIENT_CONNECT_RESPONSE:{CLIENT_ID:"clientId"},CLIENT_DISCONNECT_RESPONSE:{CLIENT_ID:"clientId"},FOCUS_CELL_RESPONSE:{X:"x",Y:"y",SHEET_ID:"sheetId",CLIENT_ID:"clientId"},DEFAULT_ROW_HEIGHT:23,DEFAULT_COLUMN_WIDTH:70,CLIENT_CONNECT_REQUEST_ID:-1,CLIENT_DISCONNECT_REQUEST_ID:-2,FOCUS_CELL_REQUEST_ID:-3,OTHER_CLIENT_CHANGED_REQUEST_ID:-4,ERROR_MESSAGE_SOCKET_REQUEST_ID:-5,OTHER_CLIENT_SAVE_REQUEST_ID:-6,ACCESS:{OWNER_ID:"ownerId",CLIENT_ID:"clientId",USER_ID:"userId",FILE_ID:"fileId",TOKEN:"token"},ERROR:{CODE:"errCode",MESSAGE:"errMsg"},WEB_SOCKET_MAX_TEXT_MESSAGE_SIZE:262144,WEB_SOCKET_MAX_BINARY_MESSAGE_SIZE:524288,DEFAULT_TABLE_COLUMN_NUM:26,DEFAULT_TABLE_ROW_NUM:40,COLLABORATE_USER_LIMIT:20,HISTORY:{TABLE_KEY:"histTbKey",TABLE_VER_NO:"histTbVerNO",TABLE_CONTENT:"histTbContent",TABLE_REVISORS:"histTbRevisors",TABLE_OPS:"histTbOpsInfo",TABLE_OPS_USR:"histTbOpsInfoUsr",TABLE_OPS_OPS:"histTbOpsInfoOps",TABLE_OPS_TIME:"histTbOpsInfoTime",TABLE_LAST_VERSION:"histTbLastVersion",TABLE_START_OPS_TIME:"histTbStartOpsTime",TABLE_LAST_OPS_TIME:"histTbLastOpsTime",TABLE_OLD_TITLE:"histTbOldTitle",TABLE_NEW_TITLE:"histTbNewTitle",TABLE_TITLE_MODIFIER:"histTbTitleModifier"}},ytb_src_client_editor_TableConvertor=function(a){var b=ytb_src_client_shared_const,c=ytb_jtk_core_underscore;return{toEditorSheet:function(a){var d,e,f,g=[],h=a.content,i=h[b.TABLE.CELLS],j=h[b.TABLE.COLUMN_WIDTHS],k=h[b.TABLE.ROW_HEIGHTS],l=k.length,m=j.length,n=a[b.TABLE.SHEET_NAME],o=a[b.TABLE.SHEET_ID];for(d=0;d<l;++d)for(g[d]=[],e=0;e<m;++e)f=d*m+e,g[d][e]=this.toEditorCell(i[f]);return{sheetName:n,sheetId:o,data:g,rowHeights:c.clone(k),colWidths:c.clone(j)}},toEditorDatas:function(a){var b=this,d=[];return c.each(a,function(a){d.push(b.toEditorSheet(a))}),d},toEditorCell:function(a){var d=b.TABLE_CELL.VALUE,e=c.omit(a,d),f={value:a[d],formulaValue:a.formulaValue||"",styles:e};return f},toServerCell:function(a){return c.extend({},{styles:a.styles},{value:a.value,formulaValue:a.formulaValue||""})},toServerSheetData:function(a){var b,d,e=a.data,f=e.length,g=e[f-1].length,h=[];for(b=0;b<f;b++)for(d=0;d<g;d++)e[b]&&e[b][d]?h.push(this.toServerCell(e[b][d])):h.push({});return{content:{cells:h,heights:c.clone(a.rowHeights),widths:c.clone(a.colWidths)},sheetId:a.sheetId,sheetName:a.sheetName}}}}({}),ytb_src_editor_config_defaults=function(a){var b,c=ytb_src_client_shared_const;return b={fontSize:12,fontName:"Microsoft YaHei",rowHeight:c.DEFAULT_ROW_HEIGHT,columnWidth:c.DEFAULT_COLUMN_WIDTH,rowPageLength:30}}({}),ytb_src_editor_core_Table=function(a){var b=ytb_jtk_core_EventClass,c=ytb_jtk_core_underscore,d=ytb_jtk_jq_jquery,e=ytb_src_client_editor_TableConvertor,f={value:"",formulaValue:"",styles:{}},g=ytb_src_editor_config_defaults,h=g.columnWidth,i=g.rowHeight,j=1,k=1,l=500,m=35,n=20;return b.extend({MAX_ROW_COUNT:l,MAX_COLUMN_COUNT:m,MAX_SHEET_COUNT:n,initialize:function(a){var b=this;b.sheets=[],a&&(b._editor=a.editor,b.sheets=a.sheets||[]),b.locked=!1,b.setContent(b.sheets),b._initEvents()},_initEvents:function(){var a=this;a.on("switchSheet",a.setActiveSheet)},getContent:function(){var a=this,b=[],d=a.sheets;return c.each(d,function(a){b.push(e.toServerSheetData(a))}),b},setContent:function(a){this.sheets=a||[],this.trigger("ready")},getEditor:function(){return this._editor},getSheetById:function(a){var b=0,c=this.sheets;for(b;b<c.length;b++)if(a===c[b].sheetId)return c[b]||{};return{}},getSheetIndexById:function(a){var b=0,c=this.sheets;for(b;b<c.length;b++)if(a===c[b].sheetId)return b;return-1},getRealSheetId:function(a){return a||this.getActiveSheetId()},getRealSheet:function(a){var b=this.getSheetById(this.getRealSheetId(a));return b.data=b.data||[],b.rowHeights=b.rowHeights||[],b.colWidths=b.colWidths||[],b.sheetId=b.sheetId||"",b.sheetName=b.sheetName||"",b},copySheet:function(a){var b={};return b.data=d.extend(!0,[],a.data),b.rowHeights=c.clone(a.rowHeights)||[],b.colWidths=c.clone(a.colWidths)||[],b.sheetId=a.sheetId||"",b.sheetName=a.sheetName||"",b},setActiveSheet:function(a){var b=this._editor,c=b.getTableEditView(),d=c.getScroll(),e=b.getSelection(),f=e.getFirstRange();this.setSheetScroll({id:this.activeSheetId,scroll:d}),this.setSheetSelection({rect:{top:f.top,bottom:f.bottom,left:f.left,right:f.right},sheetId:this.getActiveSheetId(),activeCell:e.getActiveCell()}),this.activeSheetId=a,this.setContent(this.sheets)},getActiveSheetId:function(){return this.activeSheetId||(this.activeSheetId=this.sheets[0].sheetId),this.activeSheetId||null},addSheet:function(a){var b=a.sheet,c=a.isSync;this.sheets.push(b),c?this.trigger("modify-sheet"):this.setActiveSheet(b.sheetId)},deleteSheet:function(a){var b=a.sheetId,c=a.isSync,d=this.getSheetIndexById(b);0===d&&1===this.sheets.length||(this.sheets.splice(d,1),c&&this.getActiveSheetId()!==b?this.trigger("modify-sheet"):this.setActiveSheet(this.sheets[d-1<0?0:d-1].sheetId))},modifySheet:function(a){var b=a.name,c=a.index,d=a.sheetId,e=this.getSheetIndexById(d),f=this.getSheetById(d);b&&b!==f.sheetName&&(this.sheets[e].sheetName=b,this.trigger("modify-sheet")),!c&&0!==c||c===e||(this.sheets.splice(c,0,this.sheets.splice(e,1)[0]),this.trigger("modify-sheet"))},getSheetContent:function(a){var b,d,e=this,f=e.getRowCount(a),g=e.getColumnCount(a),h={};for(h.cells=[],b=0;b<f;++b)for(d=0;d<g;d++)h.cells.push(e.copyCell(b,d,null,a));return h.widths=c.clone(this.getSheetById(a).colWidths)||[],h.heights=c.clone(this.getSheetById(a).rowHeights)||[],h},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},getRowCount:function(a){var b=this.getRealSheet(a).data;return Math.max(j,b.length)},_getColumnCount:function(a){var b=0,d=this.getRealSheet(a).data;return c.each(d,function(a){a&&(b=Math.max(b,a.length))}),Math.max(k,b)},getColumnCount:function(a){return Math.max(k,this._getColumnCount(this.getRealSheetId(a)))},getRowHeight:function(a,b){return this.getRealSheet(b).rowHeights[a]||i},setRowHeight:function(a,b,c){this.locked||(this.getRealSheet(c).rowHeights[a]=b,this.trigger("rowHeightSet",a,b,this.getRealSheetId(c)))},getColumnWidth:function(a,b){return this.getRealSheet(b).colWidths[a]||h},setColumnWidth:function(a,b,c){if(!this.locked){var d=this.getRealSheet(c).colWidths[a];this.getRealSheet(c).colWidths[a]=b,this.trigger("columnWidthSet",a,b,d,this.getRealSheetId(c))}},getValueAt:function(a,b,c){return this.getRealSheet(c).data[a]&&this.getRealSheet(c).data[a][b]?this.getRealSheet(c).data[a][b].value||f.value:f.value},setValueAt:function(a,b,c,d){this.locked||(this.ensureRow(a,d),void 0===this.getRealSheet(d).data[a][b]?this.getRealSheet(d).data[a][b]=this.createCell({value:c}):this.getRealSheet(d).data[a][b].value=c,this.getActiveSheetId()===d&&(this.trigger("valueSet",a,b,c,d),this.trigger("valueChanged",a,b,c,d)))},getFormulaAt:function(a,b,c){var d,e=this.getRealSheet(c).data;return e[a]&&e[a][b]?(d=e[a][b].formulaValue,d||0===d?d:f.formulaValue):f.formulaValue},setFormulaAt:function(a,b,c,d){if(!this.locked){var e=this.getRealSheet(d).data;this.ensureRow(a),void 0===e[a][b]?e[a][b]=this.createCell({formulaValue:c}):e[a][b].formulaValue=c,this.trigger("formulaValueChanged",a,b,c,d)}},getStylesAt:function(a,b,c){var d=this,e=d.getRealSheet(c).data;return e[a]&&e[a][b]?e[a][b].styles||f.styles:f.styles},setStylesAt:function(a,b,c,d){if(!this.locked){var e=this.getRealSheet(d).data;this.ensureRow(a,d),void 0===e[a][b]?e[a][b]=this.createCell({styles:c}):e[a][b].styles=c,this.getActiveSheetId()===d&&(this.trigger("stylesSet",a,b,c,d),this.trigger("stylesChanged",a,b,e[a][b].styles,d))}},addStylesAt:function(a,b,d,e){if(!this.locked){var f=this.getStylesAt(a,b,e),g=this.getRealSheet(e).data,h=c.clone(f);this.ensureRow(a,e),void 0===g[a][b]?g[a][b]=this.createCell({styles:d}):g[a][b].styles=c.extend(h,d),c.each(g[a][b].styles,function(c,d){c||delete g[a][b].styles[d]}),e&&this.getActiveSheetId()!==e||(this.trigger("stylesAdded",a,b,d,e),this.trigger("stylesChanged",a,b,g[a][b].styles,e))}},insertRowAt:function(a,b,c){if(!this.locked){var d,e,f=[],g=[],h=this.getRealSheet(c).data;for(d=0;d<b;++d)f.push([]),g.push(i);e=h.splice.bind(h,a,0),e.apply(null,f),e=this.getRealSheet(c).rowHeights.splice.bind(this.getRealSheet(c).rowHeights,a,0),e.apply(null,g),this.getActiveSheetId()===c&&this.trigger("rowInserted",a,b,c)}},deleteRowAt:function(a,b,c){if(!this.locked){var d=this.getColumnCount();a>0&&this.setValueAt(a-1,d-1,this.getValueAt(a-1,d-1),c),this.getRealSheet(c).data.splice(a,b),this.getRealSheet(c).rowHeights.splice(a,b),this.getActiveSheetId()===c&&this.trigger("rowDeleted",a,b,c)}},insertColumnAt:function(a,b,d){if(!this.locked){var e,f,g=this,i=a+b,j=[];for(c.each(g.getRealSheet(d).data,function(c){if(c){var d=new Array(b);e=c.splice.bind(c,a,0),e.apply(null,d)}}),f=a;f<i;++f)j.push(h);e=this.getRealSheet(d).colWidths.splice.bind(this.getRealSheet(d).colWidths,a,0),e.apply(null,j),this.getActiveSheetId()===d&&this.trigger("columnInserted",a,b,d)}},deleteColumnAt:function(a,b,d){if(!this.locked){var e=this;c.each(e.getRealSheet(d).data,function(c){c&&c.splice(a,b)}),this.getRealSheet(d).colWidths.splice(a,b),this.getActiveSheetId()===d&&this.trigger("columnDeleted",a,b,d)}},createCell:function(a){a=a||{};var b=c.defaults(a,f);return b.styles=a.styles||{},b},ensureRow:function(a,b){void 0===this.getRealSheet(b).data[a]&&(this.getRealSheet(b).data[a]=[])},copyRow:function(a,b,d){if(b=b||{styles:!0,value:!0},this.getRealSheet(d).data[a]){var e=this,f=this.getRealSheet(d).data[a],g=[];return c.each(f,function(c,f){if(c){var h=e.copyCell(a,f,b,d);g[f]=h}}),g}},copyCell:function(a,b,d,e){d=c.defaults(d||{},{styles:!0,value:!0,formulaValue:!0});var g,h=this,i=h.getRealSheet(e).data;return i[a]&&i[a][b]?(g={},d.value&&(g.value=h.getValueAt(a,b,e)),d.formulaValue&&(g.formulaValue=h.getFormulaAt(a,b,e)),d.styles&&(g.styles=c.clone(h.getStylesAt(a,b,e))),g):f},getSheetSelect:function(a){var b=this.getSheetById(a);return b._selection||{rect:{top:0,bottom:1,left:0,right:1},activeCell:{row:0,col:0}}},setSheetSelection:function(a){var b=this.getSheetById(a.sheetId);b.sheetId&&(b._selection=a)},getSheetScroll:function(a){var b=this.getSheetById(a);return b._scroll||{x:0,y:0}},setSheetScroll:function(a){var b=this.getSheetById(a.id);b._scroll=a.scroll},DEFALUT_WIDTH:h,DEFALUT_HEIGHT:i})}({}),ytb_jtk_web_dom_isTag=function(a,b){return b=String(b).toLowerCase(),!!(a&&a.nodeName&&b)&&String(a.nodeName).toLowerCase()===b},ytb_jtk_core_str_trim=function(a){return null==a||""===a?"":String(a).replace(/^[\s\t\xA0\u3000]+/,"").replace(/[\s\t\xA0\u3000]+$/,"")},ytb_jtk_core_reg_encode=function(a){return String(a).replace(/([.*?\^$=!:{}()|\[\]\/\\+])/g,"\\$1")},ytb_jtk_web_dom_className=function(a){var b=ytb_jtk_core_underscore,c=ytb_jtk_core_str_trim,d=ytb_jtk_core_reg_encode;return{has:function(a,b){return!!(a&&b&&a.className)&&(a.classList&&a.classList.contains?a.classList.contains(b):new RegExp("(^|\\s+)"+d(b)+"(\\s+|$)","").test(a.className))},add:function(a,d){var e,f=this;return a&&d&&b.isString(d)&&!f.has(a,d)?a.classList?(a.classList.add(d),f):(e=c(a.className),a.className=e?e+" "+d:d,f):f},remove:function(a,e){var f=this;return a&&e&&b.isString(e)?a.classList?(a.classList.remove(e),f):(e=String(a.className).replace(new RegExp("(^|\\s+)"+d(e)+"(\\s+|$)","g")," "),a.className=c(e),f):f},toggle:function(a,b){var c=this;return a.classList?(a.classList.toggle(b),c):c.has(b)?c.remove(a,b):c.add(a,b)}}}({}),ytb_jtk_web_bom_userAgent=function(a){var b=ytb_jtk_core_underscore,c=window.navigator.userAgent.toLowerCase(),d=function(a){var b=0;return parseFloat(a.replace(/\./g,function(){return b+=1,1===b?".":""}))},e={WEBKIT:function(){var a=c.match(/applewebkit\/([^\s]*)/);if(a&&a[1])return d(a[1])},PRESTO:function(){var a=c.match(/presto\/([\d.]*)/);if(a&&a[1])return d(a[1])},TRIDENT:function(){var a=c.match(/msie\s([^;]*)/);if(a)return a=c.match(/trident\/([\d.]*)/),a&&a[1]?d(a[1]):1},GECKO:function(){if(/gecko/.test(c)){var a=c.match(/rv:([\d.]*)/);return a&&a[1]?d(a[1]):1}}},f={RETINA:window.devicePixelRatio>=2,MOBILE:/mobile/.test(c),IPOD:/ipod/.test(c),IPAD:/ipad/.test(c),IPHONE:/iphone/.test(c),IPHONE_5:!1,IOS:!1,IOS_5:!1,IOS_6:!1,WIN:/windows|win32/.test(c),MAC:/macintosh/.test(c),IE:/msie/.test(c),IE6:/msie 6/.test(c),IE7:/msie 7/.test(c),IE8:/msie 8/.test(c),IE9:/msie 9/.test(c),IE10:/msie 10/.test(c),OPERA:/opera/.test(c),MOZ:/gecko/.test(c)&&!/(compatible|webkit)/.test(c),SAFARI:!/chrome\/([\d.]*)/.test(c)&&/\/([\d.]*) safari/.test(c),CHROME:/chrome\/([\d.]*)/.test(c),WEBKIT:!1,PRESTO:!1,TRIDENT:!1,GECKO:!1};return(f.IPHONE||f.IPOD)&&(f.IPHONE_5=window.screen.height>481),(f.IPAD||f.IPHONE||f.IPOD)&&(f.IOS=!0,f.IOS_5=/ os 5/.test(c),f.IOS_6=/ os 6/.test(c)),b.some(e,function(a,b){var c;try{if(c=a())return f[b]=c,!0}catch(d){return!1}}),f}({}),ytb_jtk_web_dom_attr=function(a){var b=ytb_jtk_web_bom_userAgent,c=ytb_jtk_core_underscore,d=b.IE,e=function(){if(null==e._isNeed){var a=document.createElement("div");a.setAttribute("class","hello"),e._isNeed=a.className.indexOf("hello")===-1}return e._isNeed},f={acceptcharset:"acceptCharset",accesskey:"accessKey",allowtransparency:"allowTransparency",bgcolor:"bgColor",cellpadding:"cellPadding",cellspacing:"cellSpacing","class":"className",colspan:"colSpan",checked:"defaultChecked",selected:"defaultSelected","for":"htmlFor",frameborder:"frameBorder",hspace:"hSpace",longdesc:"longDesc",maxlength:"maxLength",marginwidth:"marginWidth",marginheight:"marginHeight",noresize:"noResize",noshade:"noShade",readonly:"readOnly",rowspan:"rowSpan",tabindex:"tabIndex",valign:"vAlign",vspace:"vSpace"},g=e()?function(a){return f[a]||a}:function(a){return a};return{has:function(a,b,c){var d=this;return!(!a||null==b)&&(b=g(b),null==c?a.hasAttribute&&a.hasAttribute(b)||null!=a[b]:d.get(a,b)===c)},get:function(a,b){if(a&&null!=b)return d&&"style"===b?a.style.cssText:(b=g(b),a.getAttribute?a.getAttribute(b):void 0)},set:function(a,b,e){var f=this;return a&&null!=b?null==e&&c.isObject(b)?(c.each(b,function(b,c){f.set(a,c,b)}),f):d&&"style"===b?(a.style.cssText=e,f):(b=g(b),a.setAttribute&&a.setAttribute(b,e),f):f},remove:function(a,b){var c=this;return a&&null!=b?d&&"style"===b?(a.style.cssText="",c):(b=g(b),a.removeAttribute&&a.removeAttribute(b),c):c}}}({}),ytb_jtk_web_dom_Selector=function(a){function b(a){var d=this;d._options=c.extend({id:null,tag:null,className:null,attr:null,attrVal:null},c.isString(a)?b.parse(a):a),d._formatedSelector=b.stringify(d._options),d.isOptionsValid=!!d._formatedSelector,d.isOptionsValid||h.error("The options for Selector() is not valid","web/dom/Selector")}var c=ytb_jtk_core_underscore,d=ytb_jtk_web_dom_isTag,e=ytb_jtk_web_dom_className,f=ytb_jtk_web_dom_attr,g=ytb_jtk_core_str_trim,h=ytb_jtk_web_console;return b.prototype.test=function(a){var b=this,c=b._options;return!!(a&&a.nodeType&&b.isOptionsValid)&&((!c.id||a.getAttribute("id")===c.id)&&(!c.tag||d(a,c.tag))&&(!c.className||e.has(a,c.className))&&(!c.attr||f.has(a,c.attr,c.attrVal)))},b.prototype.toString=function(){var a=this;if(a.isOptionsValid)return a._formatedSelector},b.parse=function(a){if(a=g(a)){var b={selector:a},d={tag:/^([a-zA-Z]+)/,id:/#([a-zA-Z_\-\d]+)/,className:/\.([a-zA-Z_\-\d]+)/,attr:/\[([a-zA-Z_\-\d]+)(?:=([^\]]+))?\]/};return c.each(["tag","attr","id","className"],function(a){var c=d[a],e=c.exec(b.selector);e&&e[1]&&(b[a]=e[1],b.selector=g(b.selector.replace(e[0],"")),"attr"===a&&(b.attrVal=e[2]||null),b.attrVal&&(b.attrVal=b.attrVal.replace(/^['"]/,"").replace(/['"]$/,"")))}),""!==b.selector?void h.error("selector can not to be parsed","web/dom/Selector"):b.id||b.tag||b.className||b.attr?(delete b.selector,b):void 0}},b.stringify=function(a){if(c.isString(a)||!a)return a||"";var b=a.tag||"",d={id:"#",className:"."};return c.each(["id","className"],function(c){a[c]&&(b+=d[c]+a[c])}),a.attr?b+"["+a.attr+(a.attrVal?'="'+a.attrVal+'"':"")+"]":b},b}({}),ytb_jtk_web_dom_nodeType=function(a){var b=ytb_jtk_core_underscore;return{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,getType:function(a){if(a&&a.nodeType)return a.nodeType},isNode:function(a){var c=this,d=c.getType(a);return b.isNumber(d)&&d>=c.ELEMENT_NODE&&d<=c.NOTATION_NODE},isElement:function(a){return this.getType(a)===this.ELEMENT_NODE},isAttribute:function(a){return this.getType(a)===this.ATTRIBUTE_NODE},isText:function(a){return this.getType(a)===this.TEXT_NODE},isCDataSection:function(a){return this.getType(a)===this.CDATA_SECTION_NODE},isEntityReference:function(a){return this.getType(a)===this.ENTITY_REFERENCE_NODE},isEntity:function(a){return this.getType(a)===this.ENTITY_NODE},isProcessingInstruction:function(a){return this.getType(a)===this.PROCESSING_INSTRUCTION_NODE},isComment:function(a){return this.getType(a)===this.COMMENT_NODE},isDocument:function(a){return this.getType(a)===this.DOCUMENT_NODE},isDocumentType:function(a){return this.getType(a)===this.DOCUMENT_TYPE_NODE},isDocumentFragment:function(a){return this.getType(a)===this.DOCUMENT_TYPE_NODE},isNotation:function(a){return this.getType(a)===this.NOTATION_NODE}}}({}),ytb_jtk_web_dom_findParent=function(a){var b=ytb_jtk_core_underscore,c=ytb_jtk_web_dom_Selector,d=ytb_jtk_web_dom_nodeType;return function(a,e){var f;for(b.isString(e)&&(f=new c(e),e=function(a){return f.test(a)});a&&(a.nodeType===d.ELEMENT_NODE||a.nodeType===d.TEXT_NODE);){if(e(a)===!0)return a;a=a.parentNode}}}({}),ytb_jtk_web_dom_insert=function(a){return{before:function(b){var c;b&&b.parentNode&&(c=b.parentNode,c.insertBefore&&c.insertBefore(a,b))},after:function(b){var c;b&&b.parentNode&&(c=b.parentNode,b.nextSibling&&c.insertBefore?c.insertBefore(a,b.nextSibling):c.appendChild&&c.appendChild(a))}}},ytb_jtk_web_dom_remove=function(a){var b=ytb_jtk_web_dom_nodeType,c=ytb_jtk_web_dom_insert;return function(a,d){if(b.isNode(a)){if(d=d!==!1,a.removeNode&&d)return a.removeNode(a,d);if(a.parentNode&&a.parentNode.removeChild){if(!d)for(;a.firstChild;)c(a.firstChild).before(a);return a.parentNode.removeChild(a)}}}}({}),ytb_src_editor_utils_TableUtils=function(a){var b=ytb_jtk_web_dom_findParent,c=ytb_jtk_core_underscore,d=ytb_jtk_jq_jquery,e=ytb_src_editor_config_defaults.rowPageLength,f=ytb_jtk_web_dom_remove;return{WIDTH_DIFF:3,HEIGHT_DIFF:3,findParent:b,getPageInfo:function(a){var b=Math.floor(a/e);return{page:b,pageRow:a-b*e}},chunkRange:function(a,b,e,f){if(f=f||1,!c.isFunction(f)){var g=f;f=function(){return g}}var h=d.Deferred();if(!e||a>=b)return h.resolve().promise();var i=a,j=!0,k=function(){j=e(i++)!==!1,j&&i<b?window.setTimeout(k,f()):h.resolve()};return window.setTimeout(k,f()),h.promise()},forRange:function(a,b,c){var e=d.Deferred();if(!c||a>=b)return e.resolve().promise();var f;for(f=a;f<b&&c(f)!==!1;++f);return e.resolve().promise()},isRowHeader:function(a){return!!b(a,"td")&&!!b(a,".row-header")},isColHeader:function(a){return!!b(a,"th")&&!!b(a,".column-header")},isRowResizer:function(a){return a&&a.classList&&a.classList.contains("row-resizer")},isColResizer:function(a){return a&&a.classList&&a.classList.contains("col-resizer")},isTableCell:function(a){return a&&a.tagName&&"TD"===a.tagName&&!!b(a,".table-wrapper")},setElementStyles:function(a,b,d,e){var g,h,i;"true"===b.bold?a.style.fontWeight="bold":a.style.fontWeight="","true"===b.italic?a.style.fontStyle="italic":a.style.fontStyle="",h="true"===b.underline,i="true"===b.lineThrough,h&&i?a.style.textDecoration="underline line-through":h?a.style.textDecoration="underline":i?a.style.textDecoration="line-through":a.style.textDecoration="",g=b.fontName,c.isString(g)&&"default"!==g?a.style.fontFamily=g:a.style.fontFamily="",g=parseInt(b.fontSize),isNaN(g)?a.style.fontSize="":a.style.fontSize=b.fontSize,g=b.textAlign,"center"===g||"right"===g||"left"===g?a.style.textAlign=g:a.style.textAlign="",g=b.verticalAlign,"top"===g||"middle"===g||"bottom"===g?a.style.verticalAlign=g:a.style.verticalAlign="","true"===b.wrap?a.style.whiteSpace="normal":a.style.whiteSpace="",g=b.textColor,g?a.style.color=g:a.style.color="",g=b.backColor,g&&"inherit"!==g?("transparent"===g&&(g="white"),a.style.backgroundColor=g):a.style.backgroundColor="",!d||e&&e!==b["diff|user"]||(g=b.diff,"mod"===g?(a.style.backgroundColor="#e8ffb3",a.style.color="black"):"delete"===g&&(a.style.backgroundColor="#ffdbc8",a.style.color="black",a.style.textDecoration.indexOf("underline")!==-1?a.style.textDecoration="underline line-through":a.style.textDecoration="line-through")),b.link?this.setElementText(a,a.innerText,b,e):(g=a.querySelector("a"),g&&(g.firstChild&&a.appendChild(g.firstChild),f(g)))},setElementText:function(a,b,c,d){if("delete"===c.diff&&d&&d!==c["diff|user"])return void(a.innerText="");if(a.innerHTML="",c.link){var e=document.createElement("a");e.setAttribute("target","_blank"),e.setAttribute("href",c.link),c.textColor&&(e.style.color="inherit"),a.appendChild(e),a=e}a.innerText=b},getCellElFromTableEl:function(a,b,c){var d=a.rows[b];return d?d.cells[c]:null},setBorder:function(a,b,c,d){var e,f,g=d["border|vertical"],h=d["border|horizontal"];g||(f=d.backColor,g=f?"1px solid "+f:""),h||(f=d.backColor,h=f?"1px solid "+f:""),0===b?(e=a.getCellElementAt(b,c),e&&(e.style.borderTop=h)):(e=a.getCellElementAt(b-1,c),e&&(e.style.borderBottom=h)),0===c?(e=a.getCellElementAt(b,c),e&&(e.style.borderLeft=g)):(e=a.getCellElementAt(b,c-1),e&&(e.style.borderRight=g))},getStylesFromElement:function(a){var b,c={},d=a.style;return d.fontWeight.indexOf("bold")!==-1&&(c.bold="true"),d.fontStyle.indexOf("italic")!==-1&&(c.italic="true"),b=d.textDecoration,b.indexOf("underline")!==-1&&(c.underline="true"),b.indexOf("line-through")!==-1&&(c.lineThrough="true"),b=d.fontFamily,b&&(c.fontName=b),b=parseInt(d.fontSize),isNaN(b)||(c.fontSize=d.fontSize),b=d.textAlign,"center"!==b&&"right"!==b||(c.textAlign=b),b=d.verticalAlign,"top"!==b&&"middle"!==b||(c.verticalAlign=b),b=d.whiteSpace,"normal"===b&&(c.wrap="true"),b=d.color,b&&(c.textColor=b),b=d.backgroundColor,b&&"inherit"!==b&&("transparent"===b&&(b="white"),c.backColor=b),b=a.querySelector("a"),b&&b.href&&(c.link=b.href),c},getRowName:function(a){return String(a+1)},getColumnName:function(a){if(void 0===a)return"";for(var b="";a>=0;a=a/26-1)b=String.fromCharCode(a%26+"A".charCodeAt(0))+b;return b},measureText:function(a,b){var d=window.document,e=b.fontSize,f=b.fontName,g=b.isBold?"bold ":"",h=b.isItalic?"italic ":"",i=d.createElement("canvas"),j=i.getContext("2d");return c.isNumber(e)&&(e+="px"),j.font=g+h+e+" "+f,j.measureText(a)}}}({}),ytb_src_mobile_views_YNoteTableView=function(a,b,c,d,e,f,g){return b.View.extend({className:"table-view",id:"viewer-area",MIN_SCALE_VALUE:.3,MAX_SCALE_VALUE:2,_isTabWidthOverflow:!1,_tableContent:null,_touchMoveCondition:5,_touchStateTrack:null,_$activeSheet:null,_$sheetContainer:null,_sheetScaleInfo:null,_$tabContainer:null,_$tabUL:null,_contentHasBeenSet:!1,events:{touchstart:"_onTouchStart",touchmove:"_onTouchMove",touchend:"_onTouchEnd","gesturestart .sheet-container":"_onGestureStart","gesturechange .sheet-container":"_onGestureChange",
"gestureend .sheet-container":"_onGestureEnd"},initialize:function(){var a=this,b=a.options,c=document.querySelector(b.area),d=a.el;if(!c)throw"Specified area not found.";a._contentHasBeenSet=!1,d.innerHTML="加载中。。。",c.innerHTML="",c.appendChild(d)},getActiveSheetId:function(){var a=this,b="NA";return a._$activeSheet&&(b=a._$activeSheet.attr("id")||"NA"),b},getContent:function(){var a=this,b=[];return a._tableContent.forEach(function(a){b.push(f.toServerSheetData(a))}),b},setContent:function(a,b){var c=this;if(c._contentHasBeenSet=!1,!a||!a.sheets)throw"content or content.sheets cannot be null";c._tableContent=f.toEditorDatas(a.sheets),c._renderTableContainer(),c._renderTableSheets(),c._showSheetById(0,b),c._contentHasBeenSet=!0},showError:function(a){var b=this;b.el.innerHTML=a},_adjustActiveSheetPos:function(a,b){var c,e,f,g,h=this,i=h._$activeSheet.attr("id"),j=h._getSheetScaleValue(i),k=h._getSheetScaleOriginPoint(i);f=k.X*(j-1),c=h._calElemPosition(h._touchStateTrack.activeSheetOrigPos.left,h._getElemPos(h._$activeSheet,"left"),h._$activeSheet.width()*j,h._$sheetContainer.width(),a,f),g=k.Y*(j-1),e=h._calElemPosition(h._touchStateTrack.activeSheetOrigPos.top,h._getElemPos(h._$activeSheet,"top"),h._$activeSheet.height()*j,h._$sheetContainer.height(),b,g),d.log("Pos after adjusting: coords/offset/pos",c+","+e,f+","+g,h._$activeSheet.position()),h._moveActiveSheet(c-h._touchStateTrack.activeSheetOrigPos.left,e-h._touchStateTrack.activeSheetOrigPos.top)},_calElemPosition:function(a,b,c,d,e,f){var g=b;return f=f||0,0!==e&&(g=e+a),g>f||c<=d?g=f:g-f+c<d&&(g=d+f-c),g},_getElemPos:function(a,b){var c=NaN;return a&&(c=Number.parseFloat(a.css(b).replace(/px/gi,"").trim()),isNaN(c)&&(c=a.position()[b])),c},_getSheetScaleValue:function(a){var b=this;return b._sheetScaleInfo[a].scaleValue},_getSheetScaleOriginPoint:function(a){var b=this;return b._sheetScaleInfo[a].scaleOriginPoint},_setSheetScaleValue:function(a,b){var c=this;c._sheetScaleInfo[a]||(c._sheetScaleInfo[a]={}),c._sheetScaleInfo[a].scaleValue=b},_setSheetScaleOriginPoint:function(a,b,c){var d=this,e={};e.X=b,e.Y=c,d._sheetScaleInfo[a]||(d._sheetScaleInfo[a]={}),d._sheetScaleInfo[a].scaleOriginPoint=e},_isTabElement:function(a){var b=!1;return a&&a.attr("class")&&a.attr("class").startsWith("tablinks")&&(b=!0),b},_moveActiveSheet:function(a,b){var c,d,e=this;c=e._touchStateTrack.activeSheetOrigPos.left+a,d=e._touchStateTrack.activeSheetOrigPos.top+b,e._$activeSheet.css("left",c),e._$activeSheet.css("top",d)},_moveTabPosition:function(a,b){var c,d=this;d._isTabWidthOverflow&&(c=d._calElemPosition(a,d._getElemPos(d._$tabUL,"left"),d._$tabUL.width(),d._$tabContainer.width(),b),d._$tabUL.css("left",c))},_onGestureStart:function(a){var b,c,e,f=this;a.preventDefault(),f._contentHasBeenSet&&f._touchStateTrack.isGesture&&!f._touchStateTrack.isGestureStart&&(b=f._$activeSheet.attr("id"),f._touchStateTrack.originalScale=f._getSheetScaleValue(b),c=(f._touchStateTrack.touchPoints[0].X+f._touchStateTrack.touchPoints[1].X)/2-f._touchStateTrack.activeSheetOrigPos.left,e=(f._touchStateTrack.touchPoints[0].Y+f._touchStateTrack.touchPoints[1].Y)/2-f._touchStateTrack.activeSheetOrigPos.top,f._setSheetScaleOriginPoint(b,c,e),f._$activeSheet.css("transform-origin",c+"px "+e+"px"),d.log("transform-origin:",c+","+e,a),f._touchStateTrack.isGestureStart=!0)},_onGestureChange:function(a){var b=this;a.preventDefault(),b._touchStateTrack.isGesture&&(d.log(a),b._updateSheetScale(a.originalEvent.scale))},_onGestureEnd:function(a){var b=this;a.preventDefault(),b._touchStateTrack.isGesture&&!b._touchStateTrack.isGestureEnd&&(d.log(a),b._adjustActiveSheetPos(0,0)),b._touchStateTrack.isGestureEnd=!0},_onTouchStart:function(b){var c,e=this,f=b.originalEvent,g="";if(b.preventDefault(),e._contentHasBeenSet){if(d.log("_onTouchStart: initialize the touchStartTrack"),e._touchStateTrack={},e._touchStateTrack.tabULLeft=e._getElemPos(e._$tabUL,"left"),e._touchStateTrack.activeSheetOrigPos={left:e._getElemPos(e._$activeSheet,"left"),top:e._getElemPos(e._$activeSheet,"top")},e._touchStateTrack.$targetElement=a(b.target),e._touchStateTrack.isTouchMove=!1,e._touchStateTrack.isGesture=2===f.touches.length,e._touchStateTrack.isGestureEnd=!1,e._touchStateTrack.isGestureStart=!1,f.touches.length>0&&(e._touchStateTrack.touchStartX=f.touches[0].clientX,e._touchStateTrack.touchStartY=f.touches[0].clientY,g="("+f.touches[0].clientX+","+f.touches[0].clientY+")"),e._touchStateTrack.isGesture)for(g="",e._touchStateTrack.touchPoints=[],c=0;c<f.touches.length;c++)e._touchStateTrack.touchPoints.push({X:f.touches[c].clientX,Y:f.touches[c].clientY}),g=g+"("+f.touches[c].clientX+","+f.touches[c].clientY+")";d.log("TouchPoints:",g)}},_onTouchMove:function(a){var b,c,e=this,f=a.originalEvent,g=f.changedTouches[0];a.preventDefault(),e._contentHasBeenSet&&!e._touchStateTrack.isGesture&&(d.log("_onTouchMove",a),e._touchMoveCheck(g.clientX,g.clientY)&&(b=g.clientX-e._touchStateTrack.touchStartX,c=g.clientY-e._touchStateTrack.touchStartY,e._isTabElement(e._touchStateTrack.$targetElement)?e._moveTabPosition(e._touchStateTrack.tabULLeft,b):e._moveActiveSheet(b,c)))},_onTouchEnd:function(a){var b,c=this;if(a.preventDefault(),c._contentHasBeenSet&&!c._touchStateTrack.isGesture)if(d.log("_onTouchEnd",a),c._isTabElement(c._touchStateTrack.$targetElement)){if(c._touchStateTrack.isTouchMove)return;b=c._touchStateTrack.$targetElement.attr("data-value"),b!==c._$activeSheet.attr("id")&&(c._resetTabActive(),c._touchStateTrack.$targetElement.addClass("active"),c._showWholeActiveTab(c._touchStateTrack.tabULLeft,c._touchStateTrack.$targetElement),c._resetSheetActive(b))}else c._adjustActiveSheetPos(0,0)},_renderTableContainer:function(){var a,b=this;a=c.render("mobile","ynote_table_viewer",{tableData:b._tableContent}),b.$el.html(a),b._$tabContainer=b.$el.find(".tab-container"),b._$tabUL=b._$tabContainer.find(".tab"),b._isTabWidthOverflow=b._$tabContainer.width()<b._$tabUL.width(),b._$sheetContainer=b.$el.find(".sheet-container"),b._$sheetContainer.height(b.$el.height()-b._$tabContainer.height())},_renderTableSheets:function(){var a,b,c,d,f,h,i,j,k,l,m,n,o,p=this;f=new e,f.setContent(p._tableContent),p._sheetScaleInfo={},p._tableContent.forEach(function(e){for(p._setSheetScaleValue(e.sheetId,1),p._setSheetScaleOriginPoint(e.sheetId,0,0),a=p.$el.find("#"+e.sheetId),b=a.find("table"),c=b.find("tbody"),d=b.find("colgroup"),h=f.getRowCount(e.sheetId),i=f.getColumnCount(e.sheetId),n=0;n<h;++n)for(j=c[0].insertRow(n),j.style.height=f.getRowHeight(n)+"px",o=0;o<i;++o)k=j.insertCell(o),l=f.getStylesAt(n,o,e.sheetId),g.setElementStyles(k,l),p._setBorderOnTD(c[0],n,o,l),k.innerText=f.getValueAt(n,o,e.sheetId);for(o=0;o<i;++o)m=document.createElement("col"),m.style.width=f.getColumnWidth(o,e.sheetId)+"px",d[0].appendChild(m)})},_resetSheetActive:function(a){var b,c=this;c._tableContent.forEach(function(d){b=c.$el.find("#"+d.sheetId),d.sheetId===a?(b.css("display","block"),b.width(b.find("table").width()),b.height(b.find("table").height()),c._$activeSheet=b):b.css("display","none")})},_resetTabActive:function(b){var c,d=this;return d._$tabUL.children().each(function(d,e){d===b?(c=a(e.children[0]),c.addClass("active")):a(e.children[0]).removeClass("active")}),c},_setBorderOnTD:function(a,b,c,d){var e,f,g=d["border|vertical"],h=d["border|horizontal"];g||(f=d.backColor,g=f?"1px solid "+f:""),h||(f=d.backColor,h=f?"1px solid "+f:""),0===b?(e=a.rows[b].cells[c],e.style.borderTop=h):(e=a.rows[b-1].cells[c],e.style.borderBottom=h),0===c?(e=a.rows[b].cells[c],e.style.borderLeft=g):(e=a.rows[b].cells[c-1],e.style.borderRight=g)},_showSheetById:function(a,b){var c,d=this,e=0;null!=b&&d._tableContent.forEach(function(a,c){a.sheetId===b&&(e=c)}),b=d._tableContent[e].sheetId,c=d._resetTabActive(e),d._showWholeActiveTab(a,c),d._resetSheetActive(b)},_showWholeActiveTab:function(a,b){var c=this,d=c._getElemPos(c._$tabUL,"left"),e=c._getElemPos(b,"left"),f=c._$tabContainer.width()-(d+e+b.outerWidth());e+d<0?c._moveTabPosition(a,Math.abs(e+d)):f<0&&c._moveTabPosition(a,f)},_touchMoveCheck:function(a,b){var c,d,e,f=this;return f._touchStateTrack.isTouchMove||(c=a-f._touchStateTrack.touchStartX,d=b-f._touchStateTrack.touchStartY,e=Math.pow(c,2)+Math.pow(d,2),e>f._touchMoveCondition&&(f._touchStateTrack.isTouchMove=!0)),f._touchStateTrack.isTouchMove},_updateSheetScale:function(a){var b,c,e,f=this,g=f._touchStateTrack.originalScale;return isNaN(g)||isNaN(a)?(d.error("invalid scale value: originalScale/targetScale -- ",g,a),!1):!!(f._$activeSheet&&Math.abs(a-1)>1e-4)&&(b=f._$activeSheet.attr("id"),e=f._getSheetScaleValue(b),c=g*a,c<f.MIN_SCALE_VALUE?c=f.MIN_SCALE_VALUE:c>f.MAX_SCALE_VALUE&&(c=f.MAX_SCALE_VALUE),f._setSheetScaleValue(b,c),d.log("sheetScaleUpdate:",c),f._$activeSheet.css("transform","scale("+c+")"),!0)}})}(ytb_jtk_jq_jquery,ytb_jtk_mvc_Backbone,ytb_src_templates_jst,ytb_jtk_core_console,ytb_src_editor_core_Table,ytb_src_client_editor_TableConvertor,ytb_src_editor_utils_TableUtils),ytb_ynoteIndexjs=function(a,b,c){var d=new c({area:"#main"});window.DEBUG&&(window.debugTableView=d),window.BulbBridge=new b({tableView:d}).BridgeAPI}(ytb_jtk_jq_jquery,ytb_src_mobile_core_YNoteBulbBridge,ytb_src_mobile_views_YNoteTableView);